<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Exam Alert System</title>
<style>
body { 
    font-family: 'Arial', sans-serif; 
    margin: 0; padding: 0; 
    background: linear-gradient(to right, #4facfe, #00f2fe); 
    color: #fff; text-align: center; 
}
h1 { background: rgba(0,0,0,0.5); padding: 20px; margin:0; font-size:2.2em; }
label { font-weight: bold; margin-right: 10px; }
select, input[type="time"], button { font-size:1.1em; padding:10px; margin:10px 0; border-radius:8px; border:none; }
button { background-color:#2a71d0; color:#fff; cursor:pointer; transition:0.3s; }
button:hover { background-color:#1e4c99; }
#log { margin:20px auto; font-size:1.2em; max-width:700px; text-align:left; }
.alert-box { border-left:5px solid #fff; background:rgba(255,255,255,0.2); padding:12px 15px; margin:8px 0; border-radius:8px; font-weight:bold; transition: transform 0.2s; }
.alert-box:hover { transform:scale(1.02); }
.alert-normal { border-color:#00f2fe; }
.alert-extra { border-color:#ff9800; }
.container { max-width:800px; margin:auto; padding:20px; }
@media (max-width:600px){ select,input[type="time"],button{width:90%;} }
</style>
</head>
<body>

<h1>Exam Alert System</h1>

<div class="container">
    <label>Subject: </label>
    <select id="subject">
      <option value="math">Mathematics</option>
      <option value="Computer Science">Computer Science</option>
      <option value="Biology (Seperate Sciences)">Biology (Seperate Sciences)</option>
      <option value="Chemisty (Seperate Sciences)">Chemisty (Seperate Sciences)</option>
      <option value="Physics (Seperate Sciences)">Physics (Seperate Sciences)</option>
      <option value="Biology (Trilogy)">Biology (Trilogy)</option>
      <option value="Chemisty (Trilogy)">Chemisty (Trilogy)</option>
      <option value="Physics (Trilogy)">Physics (Trilogy)</option>
      <option value="Design Technology">Design Technology</option>
      <option value="Drama">Drama</option>
      <option value="Dutch">Dutch</option>
      <option value="English Language">English Language </option>
      <option value="English Literature">English Literature </option>
      <option value="Food and Nutrition">Food and Nutrition </option>
      <option value="French">French </option>
      <option value="German">German </option>
      <option value="History">History </option>
      <option value="Geography">Geography </option>
      <option value="Music">Music</option>
      <option value="PE">PE </option>
    </select>
    <br>
    <label>Exam Start Time: </label>
    <input type="time" id="startTime">
    <br>
    <button onclick="startExam()">Start / Save Exam</button>
</div>

<div id="log"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ================= GLOBAL VARIABLES =================
const EXTRA_PERCENT = 25; // Extra time for students
const subjects = {
    math: 90,
    "Computer Science":90,
    "Biology (Seperate Sciences)":90,
    "Chemisty (Seperate Sciences)":90,
    "Physics (Seperate Sciences)":90,
    "Biology (Trilogy)":60,
    "Chemisty (Trilogy)":60,
    "Physics (Trilogy)":60,
    "Design Technology":90,
    Drama:90,
    Dutch:90,
    "English Language":90,
    "English Literature":90,
    "Food and Nutrition":90,
    French:90,
    German:90,
    History:80,
    Geography:90,
    Music:90,
    PE:90
};
// ====================================================

// ----- Firebase Config -----
const firebaseConfig = {
  apiKey: "AIzaSyBG9HsrRsFq8YLkUHTDi4XlREdYwX1Jyd0",
  authDomain: "exam-notice-86cd4.firebaseapp.com",
  databaseURL: "https://exam-notice-86cd4-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "exam-notice-86cd4",
  storageBucket: "exam-notice-86cd4.firebasestorage.app",
  messagingSenderId: "1:717990898282:web:f627c05aacf7aeca657813",
  appId: "G-P8V3QY92TT"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Listen to real-time updates
db.ref("exams").on("value", snapshot => {
    const exams = snapshot.val() || {};
    renderExams(exams);
});

function startExam() {
    const subject = document.getElementById("subject").value;
    const time = document.getElementById("startTime").value;
    if(!time){ alert("Enter start time!"); return; }
    db.ref("exams/" + subject).set({ startTime: time });
}

// Render exams from Firebase
function renderExams(exams){
    document.getElementById("log").innerHTML = "";
    const now = new Date();

    for(let subject in exams){
        const data = exams[subject];
        const [h,m] = data.startTime.split(":");
        const startDate = new Date();
        startDate.setHours(h); startDate.setMinutes(m); startDate.setSeconds(0);

        const normalDur = subjects[subject];
        const extraDur = normalDur + normalDur*EXTRA_PERCENT/100;

        const events = [
            {time: new Date(startDate.getTime() + (normalDur-30)*60000), label:`NORMAL: Last 30 min`, type:'normal'},
            {time: new Date(startDate.getTime() + (extraDur-30)*60000), label:`EXTRA: Last 30 min`, type:'extra'},
            {time: new Date(startDate.getTime() + (normalDur-5)*60000), label:`NORMAL: Last 5 min`, type:'normal'},
            {time: new Date(startDate.getTime() + normalDur*60000), label:`NORMAL: Finished`, type:'normal'},
            {time: new Date(startDate.getTime() + (extraDur-5)*60000), label:`EXTRA: Last 5 min`, type:'extra'},
            {time: new Date(startDate.getTime() + extraDur*60000), label:`EXTRA: Finished`, type:'extra'}
        ];

        events.forEach(ev=>{
            const div = document.createElement("div");
            div.className = `alert-box ${ev.type==='extra'?'alert-extra':'alert-normal'}`;
            div.textContent = `${subject} - ${ev.label} @ ${ev.time.toLocaleTimeString()}`;
            document.getElementById("log").appendChild(div);

            // Optional voice alert
            const delay = ev.time - now;
            if(delay>0){
                setTimeout(()=>{ speak(`${subject} - ${ev.label}`); }, delay);
            }
        });
    }
}

function speak(text){
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "en-US";
    window.speechSynthesis.speak(utter);
}
</script>

</body>
</html>
